---
title: Migrating from SpocR to Xtraq (DRAFT)
description: High-level guide for replacing legacy SpocR-generated artefacts with Xtraq pipelines in an existing solution.
---

_DRAFT_

> Use this playbook once you have audited your applications and confirmed that the remaining gaps in Xtraq have been addressed. It focuses on the final migration activity rather than discovery or optimisation.

## Overview

| Step         | Outcome                                                                                           |
| ------------ | ------------------------------------------------------------------------------------------------- |
| Prepare      | Team agrees on migration scope, timelines, and rollback plan.                                     |
| Cut-over     | SpocR artefacts are replaced with Xtraq equivalents, and cross-cutting behaviours are reattached. |
| Validate     | Regression tests, performance checks, and observability confirm parity.                           |
| Decommission | Legacy assets are retired, documentation updated, and lessons captured.                           |

## Prerequisites

- Audit of SpocR usage is complete and tracked in an internal backlog.
- Xtraq generator settings (snapshots, configuration) are verified against the target environment.
- Required features or optimisations (for example table-type trimming, execution policies, DI-scoped transaction orchestrator with ambient EF support) have landed in your branch or are covered by feature flags.
- Legacy result envelopes that must stay compatible (for example `ResponseResult`) have a documented adapter plan using pipeline policies or interceptors.
- Stakeholders sign off on the migration schedule and rollback triggers.

> ðŸ’¡ **Prompt idea**: _"Review our SpocR â†’ Xtraq readiness checklist and report any missing prerequisites."_

## Migration Steps

1. **Generate fresh Xtraq artefacts**
   - Run the agreed snapshot/build workflow.
   - Commit or stage the generated code on a dedicated migration branch.
2. **Replace application wiring**
   - Update dependency injection and project references to point at the Xtraq assemblies.
   - Introduce the DI-scoped transaction orchestrator (or interim wrapper) so procedure calls share the intended connection/transaction scope.
   - When Entity Framework Core remains in the request pipeline, adapt your generated `IXtraqDbContext` to implement `IXtraqAmbientTransactionAccessor` so the orchestrator can join EF-managed transactions (see [Entity Framework Integration](../../3.reference/6.entity-framework-integration.md)).
   - Swap SpocR invocation sites with `ConfigureProcedure(...)`, pipeline execution methods, and policies.
   - Ensure table types, DTOs, and streaming helpers map to the new structures.
3. **Reconnect cross-cutting concerns**
   - Attach `IProcedureExecutionPolicy` implementations for retries, caching, history logging, or timeouts.
   - Register consumer-side interceptors/transformers that wrap pipeline results into legacy contracts (for example `ResponseResult`) when required.
   - Add `WithLabel(...)` annotations for telemetry and logging scopes.
   - Verify diagnostics pipelines or tracing remain functional.
4. **Feature toggles & deployment**
   - Wrap the migration behind feature flags, environment toggles, or staged rollouts.
   - Document rollback instructions referencing the flag/branch.

> ðŸ’¡ **Prompt idea**: _"Refactor this service to call the Xtraq pipeline and include a labelled retry policy."_
> ðŸ’¡ **Prompt idea**: _"Create a pipeline policy that maps `InvoiceCreateResult` into our existing `ResponseResult` shell."_

## Validation

- Execute automated tests covering critical stored procedures and integration paths.
- Exercise transaction rollbacks and nested transaction paths to ensure the orchestrator behaves like the legacy managers.
- Perform targeted performance benchmarks comparing latency and throughput to the SpocR baseline.
- Confirm observability signals (logs, metrics, traces) include the new pipeline labels and policies.
- Conduct manual exploratory testing for edge cases identified during the audit.

> ðŸ’¡ **Prompt idea**: _"Generate a validation checklist for the Xtraq migration including performance and observability steps."_

## Decommissioning and Follow-Up

1. Toggle production traffic to Xtraq paths and monitor for the agreed soak period.
2. Remove SpocR references from solution files, CI pipelines, and deployment scripts.
3. Archive or delete legacy artefacts once rollback is no longer required.
4. Update internal and external documentation to reference the Xtraq workflow.
5. Capture lessons learned and store reusable AI prompt templates in the team knowledge base.

> ðŸ’¡ **Prompt idea**: _"Draft a release note summarising the migration from SpocR to Xtraq and its operational impact."_

## Quick Checklist

- [ ] Migration prerequisites satisfied and approved.
- [ ] Xtraq artefacts generated and integrated.
- [ ] Transaction orchestrator or interim wrapper wired into the DI scope.
- [ ] Result adapter/interceptor strategy implemented where legacy envelopes remain.
- [ ] Regression, performance, and observability checks passed.
- [ ] Legacy SpocR assets removed or archived.
- [ ] Documentation and knowledge base updated.
