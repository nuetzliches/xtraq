---
title: CLI Telemetry Alignment
description: Tracking the rollout of Xtraq's DOTNET CLI telemetry compliance.
---

## Status · 2025-11-18

- Stage 1 implements a local hashed usage channel that writes `.xtraq/telemetry/cli-usage.jsonl` per invocation.
- Opt-out now honours `DOTNET_CLI_TELEMETRY_OPTOUT`, `XTRAQ_CLI_TELEMETRY_OPTOUT`, and `XTRAQ_TELEMETRY_OPTOUT`, and telemetry is skipped automatically when common CI indicators are present.
- A first-run disclosure banner mirrors the .NET CLI wording and records consent state in `.xtraq/telemetry/cli-telemetry-consent.json`.
- Automated coverage under `tests/Xtraq.Tests/CliTelemetryServiceTests.cs` validates opt-out parsing, CI suppression, local persistence, and consent marker handling.

## Decision · Remain Local-Only

After reviewing the [official .NET CLI telemetry guidance](https://aka.ms/dotnet-cli-telemetry) we have decided to **keep Xtraq's CLI telemetry local-only** for the time being.

- No anonymised aggregates are uploaded or transmitted off-device. The JSONL log is intended for manual diagnostics that teams can opt into when investigating CLI performance.
- Remote publishing would require an ingestion endpoint, retention policy, encryption in transit, and a privacy review. None of those pieces are in place yet, so we are deferring remote collection until the infrastructure exists.
- The disclosure banner now points to this page so users can verify exactly what is stored locally and how to opt out.

### Design Principles

1. **Consent first.** Telemetry is disabled automatically whenever any recognised opt-out variable is set or a CI environment is detected.
2. **Hash everything sensitive.** Paths, procedure filters, and machine identifiers are only stored as SHA256 hashes; raw values never touch disk.
3. **Keep the schema documented.** `CliTelemetryService` persists envelopes containing only command metadata and switch usage, mirroring the fields in `CliTelemetryEnvelope`.

## Next Steps

1. Revisit remote aggregation once we can host a privacy-reviewed ingestion endpoint (earliest Q2 2026).
2. Add a short CLI command (`xtraq telemetry export`) that redacts and packages local telemetry when users explicitly share diagnostics.
3. Publish a schema diagram for the telemetry envelope in the reference docs so downstream tooling can parse `.jsonl` files when needed.

## References

- [.NET CLI telemetry guidance](https://aka.ms/dotnet-cli-telemetry)
