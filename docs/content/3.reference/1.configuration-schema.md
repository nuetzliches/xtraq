---
title: Tracked Configuration & Environment Bootstrap
description: The xtraq CLI keeps project settings deterministic by committing a `.xtraqconfig` file and limiting the local `.env` to secrets or machine-specific overrides. CLI flags and process-level environment variables can always override both, but the tracked JSON snapshot supplies the team defaults that keep generated output stable.
---

## Configuration Model Overview

- `.xtraqconfig` – version-controlled JSON that captures non-sensitive defaults (for example target framework or schema allow-list) and optional overrides such as namespace or output folder. Every clone reads this file so the entire team works from the same baseline.
- `.env` – private developer file used for secrets (`XTRAQ_GENERATOR_DB`) and rare local adjustments. It stays out of source control and should remain minimal.
- `ProjectEnvironmentBootstrapper` – helper that scaffolds a minimal `.env`, derives `.xtraqconfig` from CLI inputs, and updates both without clobbering intentional values.

## Resolution Order

1. CLI arguments (for example `xtraq build --output Generated`)
2. Process environment variables (`XTRAQ_NAMESPACE=Acme.App.Data xtraq build`)
3. `.env` (secrets and developer overrides)
4. `.xtraqconfig` (canonical team defaults)
5. Built-in defaults baked into the CLI

Although `.env` is higher in the precedence chain, prefer storing any non-secret value in `.xtraqconfig`. That way new machines or CI agents do not depend on copying a local `.env` file.

## Editing `.xtraqconfig`

`xtraq init` writes `.xtraqconfig` automatically, but you can edit it directly to capture project-wide changes. Every property in the file is optional—you can omit the entire object and rely on the defaults, or override only the values that need to differ. When `Namespace` is absent, the CLI infers it from the consuming project/assembly; when `OutputDir` is missing, the generator defaults to `Xtraq`.

```json
{
  "Namespace": "Contoso.Billing",
  "OutputDir": "Xtraq",
  "TargetFramework": "net8.0",
  "BuildSchemas": ["core", "identity"]
}
```

| Property          | Description                                                     | Default when omitted                                | Notes                                   |
| ----------------- | --------------------------------------------------------------- | --------------------------------------------------- | --------------------------------------- |
| `Namespace`       | Base namespace for generated artefacts                          | Inferred from consuming project/assembly name       | Override when the default is unsuitable |
| `OutputDir`       | Relative folder that receives generated files                   | `Xtraq`                                             | Pick a different folder if needed       |
| `TargetFramework` | Template hint used during generation (e.g. `net8.0`, `net10.0`) | `net8.0`                                            | Subject to roadmap upgrade              |
| `BuildSchemas`    | Allow-list of schemas to include                                | Includes every discovered schema (empty allow-list) | Provide values to restrict generation   |

Recommendations:

- Commit `.xtraqconfig` with every intentional change so teammates receive the same defaults.
- Prefer arrays for `BuildSchemas` even when only one schema is included; the bootstrapper preserves ordering and removes duplicates.
- When experimenting, edit `.xtraqconfig`, run `xtraq build`, review the diff, and commit the configuration and generated artefacts together.

### `.xtraqconfig` Standard Payload

When the file stores configuration directly, the tracked JSON exposes only non-sensitive knobs. Secrets such as `XTRAQ_GENERATOR_DB` are never written to `.xtraqconfig`; they stay exclusively in `.env` or external secrets stores.

- `Namespace` maps to the `XTRAQ_NAMESPACE` environment variable.
- `OutputDir` maps to `XTRAQ_OUTPUT_DIR` (defaults to `Xtraq` when omitted).
- `TargetFramework` acts as metadata for templates and tooling.
- `BuildSchemas` mirrors `XTRAQ_BUILD_SCHEMAS` as a distinct array.

### `.xtraqconfig` Redirect Mode (Optional)

If the file contains a `ProjectPath` property, xtraq treats it as a redirect. The value can be:

- `"."` to point at the same directory (used by `xtraq init` during bootstrap).
- A relative path to another directory that hosts the real `.xtraqconfig` and `.env`.
- An absolute path when the tracked configuration lives outside the repository.

In redirect mode all other properties in the file are ignored. Redirect chains up to ten levels are supported; circular references resolve to the last visited directory to avoid infinite loops. Redirects are mainly used to avoid generating artefacts in the execution directory—for example when `.xtraqconfig` lives under `src/` while commands run from the repository root.

## Required Keys

| Key                  | Purpose                                                  | Notes                                                                              |
| -------------------- | -------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| `XTRAQ_GENERATOR_DB` | Connection string used for metadata snapshots and builds | Required. Must be stored in `.env` or environment not checked into source control. |

## Optional Keys

| Key                                     | Purpose                                                          | Default behaviour when unset                  |
| --------------------------------------- | ---------------------------------------------------------------- | --------------------------------------------- |
| `XTRAQ_NAMESPACE`                       | Overrides the inferred root namespace for generated artefacts    | Namespace inferred from project/assembly name |
| `XTRAQ_OUTPUT_DIR`                      | Customises the relative output directory for generated artefacts | `Xtraq`                                       |
| `XTRAQ_BUILD_SCHEMAS`                   | Allow-list of schemas to include during generation               | Empty list ⇒ include every discovered schema  |
| `XTRAQ_NO_UPDATE` / `XTRAQ_SKIP_UPDATE` | Disables auto-update prompts when set                            | Prompts remain enabled                        |
| `XTRAQ_VERBOSE`                         | Emits additional diagnostics when set to `1`                     | Standard informational logging                |

## Minimal `.env` Responsibilities

The bootstrapper copies `.env.example`, but only a handful of keys are required for day-to-day work. Keep everything else commented unless you are actively testing a preview feature.

```dotenv
XTRAQ_GENERATOR_DB=Server=localhost;Database=AppDb;Trusted_Connection=True;TrustServerCertificate=True;
```

| Key                  | Purpose                                            | Guidance                                               |
| -------------------- | -------------------------------------------------- | ------------------------------------------------------ |
| `XTRAQ_GENERATOR_DB` | Metadata discovery connection string               | Required secret – never commit, rotate regularly       |
| `XTRAQ_NO_UPDATE`    | Disables CLI auto-update checks                    | Optional local toggle (`1`, `true`, `yes`, `on`)       |
| `XTRAQ_LOG_LEVEL`    | Overrides logging verbosity (`info`, `debug`)      | Useful for temporary diagnostics                       |
| `XTRAQ_CONFIG_PATH`  | Points the CLI at an alternate `.xtraqconfig` root | Rare – primarily for CI scenarios or integration tests |

## Bootstrap Workflow

Running `xtraq init` or invoking commands that require configuration triggers the bootstrapper:

1. Ensures a `.env` exists; if missing, offers to create a minimal file and copies comments from `.env.example` verbatim.
2. Applies CLI parameters (namespace, schemas, output directory) to the tracked configuration.
3. Writes or updates `.xtraqconfig`, carrying forward existing values to avoid accidental resets.
4. Prints a summary instructing you to review secrets before continuing.

Re-run `xtraq init --force` whenever template keys change upstream or you want to rebuild `.env` from scratch while preserving `.xtraqconfig`.

## Maintenance Checklist

- When adjusting namespaces or output folders, update `.xtraqconfig` first, then regenerate artefacts.
- Keep `.env.example` aligned with the keys that the CLI understands; every documented key should include a sentence in this page.
- If CI needs different settings, prefer environment variables over editing `.xtraqconfig` so local clones remain authoritative.

## Security Guidelines

- Never commit secrets. If a credential slips into source control, rotate it immediately and force-push a scrubbed history when appropriate.
- Use least-privilege SQL accounts for generator operations.
- Document credential rotation in team runbooks and treat `.env` as disposable.

## FAQ

**Can `.env` live outside the repository?**

Yes. Pass `XTRAQ_CONFIG_PATH` and `XTRAQ_GENERATOR_DB` as process environment variables in CI/CD or containerised environments. The CLI resolves relative hints against the working directory when needed.

**How do I absorb new keys from the template?**

Pull the latest changes, run `xtraq init --force`, review the resulting `.env` diff, and update this page if new keys are promoted to tracked configuration.

## Validation Checklist

- `.env` exists in every project that runs the current CLI and contains at least `XTRAQ_GENERATOR_DB`.
- CI and local scripts resolve settings from environment variables or `.env` to ensure secrets remain outside source control.
- `.xtraqconfig` changes are reviewed like code and committed alongside feature work so every clone shares the same defaults.
